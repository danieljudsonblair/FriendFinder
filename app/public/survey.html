<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Find Your Partner in Crime!</title>

  <!-- Latest compiled and minified CSS & JS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

</head>

<body style="background-color: black; color: lightgray">
    <div class="container">
        <div style="text-align: center; padding-top: 5%"><h1>Take the Compatability Survey</h1></div>
        <hr style="border-color: lightgray">
        <form class="form">
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" required>
            </div>
            <div class="form-group">
                <label for="image">Image URL</label>
                <input type="url" class="form-control" id="image" required>
            </div>
            <br>
            <br>
            <h5>Select how much you agree with the following statements (1 - Strongly Disagree, 5 - Strongly Agree).</h2>
            <hr style="border-color: lightgray">
            <div class="form-group">
                <label for="ques1" class="lead"><strong>1: You look forward to Walmart trips for shoplifting opportunities.</strong></label><br>
                <input type="radio" name="q1" value="1"> 1
                <input type="radio" name="q1" value="2"> 2
                <input type="radio" name="q1" value="3"> 3 
                <input type="radio" name="q1" value="4"> 4
                <input type="radio" name="q1" value="5"> 5 
            </div>
            <br>
            <div class="form-group">
                <label for="q2" class="lead"><strong>2: You enjoy the challenge of successfully forging someone's signature on a check.</strong></label><br>
                <input type="radio" name="q2" value="1"> 1
                <input type="radio" name="q2" value="2"> 2
                <input type="radio" name="q2" value="3"> 3 
                <input type="radio" name="q2" value="4"> 4
                <input type="radio" name="q2" value="5"> 5 
            </div>
            <br>
            <div class="form-group">
                <label for="q3" class="lead"><strong>3: You agree with the statement "Happiness is a warm gun Mama".</strong></label><br>
                <input type="radio" name="q3" value="1"> 1
                <input type="radio" name="q3" value="2"> 2
                <input type="radio" name="q3" value="3"> 3 
                <input type="radio" name="q3" value="4"> 4
                <input type="radio" name="q3" value="5"> 5 
            </div>
            <br>
            <div class="form-group">
                <label for="q4" class="lead"><strong>4: When driving, if a police officer is behind you, you immediately start making right turns.</strong></label><br>
                <input type="radio" name="q4" value="1"> 1
                <input type="radio" name="q4" value="2"> 2
                <input type="radio" name="q4" value="3"> 3 
                <input type="radio" name="q4" value="4"> 4
                <input type="radio" name="q4" value="5"> 5 
            </div>
            <br>
            <div class="form-group">
                <label for="q5" class="lead"><strong>5: A swift punch to the face is the best way to end an argument with your SO.</strong></label><br>
                <input type="radio" name="q5" value="1"> 1
                <input type="radio" name="q5" value="2"> 2
                <input type="radio" name="q5" value="3"> 3 
                <input type="radio" name="q5" value="4"> 4
                <input type="radio" name="q5" value="5"> 5 
            </div>
            <br>
            <div class="form-group">
                <label for="q6" class="lead"><strong>6: You consider yourself a "distributor" moreso than a "user".</strong></label><br>
                <input type="radio" name="q6" value="1"> 1
                <input type="radio" name="q6" value="2"> 2
                <input type="radio" name="q6" value="3"> 3 
                <input type="radio" name="q6" value="4"> 4
                <input type="radio" name="q6" value="5"> 5 
            </div>
            <br>
            <div class="form-group">
                <label for="q7" class="lead"><strong>7: You agree with the statement "snitches get stitches".</strong></label><br>
                <input type="radio" name="q7" value="1"> 1
                <input type="radio" name="q7" value="2"> 2
                <input type="radio" name="q7" value="3"> 3 
                <input type="radio" name="q7" value="4"> 4
                <input type="radio" name="q7" value="5"> 5 
            </div>
            <br>
            <div class="form-group">
                <label for="q8" class="lead"><strong>8: You could do 3 years "standing on your head".</strong></label><br>
                <input type="radio" name="q8" value="1"> 1
                <input type="radio" name="q8" value="2"> 2
                <input type="radio" name="q8" value="3"> 3 
                <input type="radio" name="q8" value="4"> 4
                <input type="radio" name="q8" value="5"> 5 
            </div>
            <br>
            <div class="form-group">
                <label for="q9" class="lead"><strong>9: You freqently are in possession of illegal items that aren't even yours.</strong></label><br>
                <input type="radio" name="q9" value="1"> 1
                <input type="radio" name="q9" value="2"> 2
                <input type="radio" name="q9" value="3"> 3 
                <input type="radio" name="q9" value="4"> 4
                <input type="radio" name="q9" value="5"> 5 
            </div>
            <br>
            <div class="form-group">
                <label for="q10" class="lead"><strong>10: Armed robbery is ok as long as you are trying to feed your family.</strong></label><br>
                <input type="radio" name="q10" value="1"> 1
                <input type="radio" name="q10" value="2"> 2
                <input type="radio" name="q10" value="3"> 3 
                <input type="radio" name="q10" value="4"> 4
                <input type="radio" name="q10" value="5"> 5 
            </div>
            <br>
            <button type="button" id="submit" class="btn btn-success" data-toggle="modal" data-target="#modal">Submit!</button>
        </form>
        <br />
        <footer class="footer">
            <div class="container">
                <p><a href="/api/friends" target='_blank'>API Friends List</a> | <a href="https://github.com/danieljudsonblair/FriendFinder" target='_blank'>GitHub</a></p>
            </div>
        </footer>
    </div>
    <div class="modal fade" id="modal" role="dialog">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"></h4>
                </div>
                <div class="modal-body"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">

    var name, image, q1, q2, q3, q4, q5, q6, q7, q8, q9, q10, newPerson;

    $('#submit').on('click', function(event) {
        event.preventDefault();
        name = $('#name').val().trim();
        image = $('#image').val().trim();
        q1 = parseInt($("input[name=q1]:checked").val());
        q2 = parseInt($("input[name=q2]:checked").val());
        q3 = parseInt($("input[name=q3]:checked").val());
        q4 = parseInt($("input[name=q4]:checked").val());
        q5 = parseInt($("input[name=q5]:checked").val());
        q6 = parseInt($("input[name=q6]:checked").val());
        q7 = parseInt($("input[name=q7]:checked").val());
        q8 = parseInt($("input[name=q8]:checked").val());
        q9 = parseInt($("input[name=q9]:checked").val());
        q10 = parseInt($("input[name=q10]:checked").val());
        newPerson = {
            name: name,
            image: image,
            responses: [q1, q2, q3, q4, q5, q6, q7, q8, q9, q10],
            total: q1 + q2 + q3 + q4 + q5 + q6 + q7 + q8 + q9 + q10
        };
        console.log(newPerson);



        if (formIsValid()) {
            $.get("/api/friends", function(data) {
                var match = findMatch(data);
                if (match.name !== undefined) {
                    $('.modal-title').text('You have a match!');
                    $('.modal-body').html('<p class="strong">You\'re most compatible with:</p><p>' + match.name + '</p><img src="' + match.image + '" height="45">');
                } else {
                    $('.modal-title').text('Not enough friends');
                    $('.modal-body').text('Sorry, there are not enough friends to match you with.');
                }
            }).then(function() {
                $('#modal').show();
                $('.form')[0].reset();
                $.post("/api/friends", newPerson);
            });
        } else {
            $('.modal-title').text('Error');
            $('.modal-body').text('You need to fill in more questions.');
            $('#modal').show();
        }
    });
    function formIsValid() {
        return (name !== '' && image !== '' && !isNaN(q1) && !isNaN(q2) && !isNaN(q3) && !isNaN(q4) &&
            !isNaN(q5) && !isNaN(q6) && !isNaN(q7) && !isNaN(q8) && !isNaN(q9) && !isNaN(q10));
    }
    function findMatch(data) {
        var diff = 50;
        var minDiffName;
        var minDiffImage;
        data.forEach(function(person) {
            var localDiff = Math.abs(newPerson.total - person.total);
            if (localDiff < diff) {
                diff = localDiff;
                minDiffName = person.name;
                minDiffImage = person.image;
            }
        });
        return {
            name: minDiffName,
            image: minDiffImage
        };
    }
    </script>
</body>

</html>